1Ô∏è‚É£ Login via API Key

Endpoint: POST /login_apikey

Fluxo:

O cliente envia a API Key no header: x-api-key: <API_KEY>.

O Depends(get_current_client) valida se a API Key est√° na lista VALID_API_KEYS.

Se inv√°lida ‚Üí retorna 401 Unauthorized.

Se v√°lida ‚Üí o backend gera:

Access Token (create_access_token) ‚Üí v√°lido por ACCESS_TOKEN_EXPIRE_MINUTES (atualmente 7 dias no seu settings, mas voc√™ comentou que quer 1 hora).

Refresh Token (create_refresh_token) ‚Üí v√°lido por REFRESH_TOKEN_EXPIRE_DAYS (configurado como 7 dias).

Retorna JSON:

{
  "access_token": "...",
  "refresh_token": "...",
  "token_type": "bearer"
}


üí° Resumo: Aqui voc√™ troca uma API Key est√°tica por tokens JWT que expiram, garantindo mais seguran√ßa.

2Ô∏è‚É£ Usando o Access Token

Endpoints protegidos, exemplo: GET /me

Fluxo:

O cliente envia header: Authorization: Bearer <ACCESS_TOKEN>.

O Depends(get_current_user_from_jwt) decodifica o token:

Verifica assinatura e validade (jwt.decode).

Confirma que existe o campo sub ‚Üí identifica o cliente.

Se o token for v√°lido ‚Üí retorna os dados protegidos.

Se o token expirar ou for inv√°lido ‚Üí retorna 401 Unauthorized.

üí° Resumo: O Access Token √© usado para autenticar requisi√ß√µes at√© expirar. Depois disso, o cliente precisa de um novo token.

3Ô∏è‚É£ Refresh Token

Endpoint: POST /refresh_apikey

Fluxo:

O cliente envia o Refresh Token via header Authorization: Bearer <REFRESH_TOKEN>.

O backend decodifica o token:

Verifica assinatura e validade.

Confirma que o type √© "refresh_token" (n√£o √© um access token disfar√ßado).

Extrai sub do payload.

Se v√°lido ‚Üí gera novos Access e Refresh Tokens e retorna para o cliente:

{
  "access_token": "...",
  "refresh_token": "...",
  "token_type": "bearer"
}


Se inv√°lido ‚Üí retorna 401 Unauthorized.

üí° Resumo: O Refresh Token permite ao cliente obter novos tokens sem precisar enviar a API Key de novo, mantendo o usu√°rio "logado" de forma segura.

4Ô∏è‚É£ Ciclo de uso t√≠pico

App mobile envia API Key ‚Üí recebe Access + Refresh Token.

App usa Access Token para chamadas protegidas (/me, etc.).

Quando o Access Token expira:

App envia Refresh Token para /refresh_apikey.

Recebe novos Access + Refresh Token.

Quando o Refresh Token expira:

Usu√°rio precisa fazer login novamente usando API Key.